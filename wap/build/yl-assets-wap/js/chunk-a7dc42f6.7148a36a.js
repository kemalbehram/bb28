(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a7dc42f6"],{"084f":function(t,e,a){"use strict";var s=a("a1eb"),n=a.n(s);n.a},"2aa8":function(t,e,a){"use strict";var s=a("dd2a"),n=a.n(s);n.a},3937:function(t,e,a){},"48f3":function(t,e,a){"use strict";var s=a("aace"),n=a.n(s);n.a},"634d":function(t,e,a){},"63e6":function(t,e,a){"use strict";var s=a("634d"),n=a.n(s);n.a},"7f51":function(t,e,a){},8837:function(t,e,a){"use strict";var s=a("7f51"),n=a.n(s);n.a},a1eb:function(t,e,a){},aace:function(t,e,a){},bcfd:function(t,e,a){"use strict";var s=a("3937"),n=a.n(s);n.a},dd2a:function(t,e,a){},efaa:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"chat-message-container"},[a("van-nav-bar",{staticClass:"shadow-bottom",attrs:{border:!1,fixed:"",title:"在线客服"}},[a("van-icon",{staticClass:"nav-bar-left",attrs:{slot:"left",name:"arrow-left",size:"22"},on:{click:function(e){return t.$store.dispatch("toBack")}},slot:"left"})],1),a("div",{staticClass:"chat-bar shadow-top"},[a("van-field",{staticClass:"chat-bar-content",attrs:{border:!1,placeholder:"请输入聊天内容"},model:{value:t.message,callback:function(e){t.message=e},expression:"message"}},[a("van-uploader",{staticClass:"chat-bar-button",attrs:{slot:"label","after-read":t.sendImage},slot:"label"},[a("van-button",{staticClass:"chat-bar-button send-image",attrs:{border:!1,loading:t.loading_image,"loading-type":"spinner"}},[t._v("图片")])],1),a("van-button",{staticClass:"chat-bar-button send-message",attrs:{slot:"button",loading:t.loading_send,color:"#ff6f64","loading-type":"spinner"},on:{click:t.sendMessage},slot:"button"},[t._v("发送")])],1)],1),a("items",{ref:"chat"})],1)},n=[],i=(a("99af"),a("ac1f"),a("5319"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"swipedown",rawName:"v-swipedown",value:function(e){return t.touch("toTop")},expression:"(e)=>touch('toTop')"},{name:"swipeup",rawName:"v-swipeup",value:function(e){return t.touch("toDwon")},expression:"(e)=>touch('toDwon')"}],staticClass:"chat-message-content",class:{anim:1==t.animate},attrs:{id:"chat-window"}},[a("van-pull-refresh",{attrs:{"loosing-text":"释放加载更多聊天","pulling-text":"下拉即可加载"},on:{refresh:t.$parent.getIndex},model:{value:t.$parent.loading,callback:function(e){t.$set(t.$parent,"loading",e)},expression:"$parent.loading"}},[a("div",{attrs:{slot:"loading"},slot:"loading"},[t._v("数据加载中")]),t._l(t.current.record,(function(e,s){return a("div",{key:s},[a("chat-item-time",{attrs:{time:s}}),t._l(e,(function(e){return["image"===e.message_type?a("chat-item-image",{key:e.id,attrs:{avatar:t.getAvatar(e.from),data:e,opposite:1e5!==e.from,wechat:e.wechat}}):a("chat-item-text",{key:e.id,attrs:{avatar:t.getAvatar(e.from),data:e,opposite:1e5!==e.from,wechat:e.wechat}})]}))],2)}))],2)],1)}),o=[],r=(a("4160"),a("159b"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"chat-item-time"},[a("span",{domProps:{innerHTML:t._s(t.time)}})])}),c=[],l={props:{time:""}},u=l,d=(a("084f"),a("2877")),h=Object(d["a"])(u,r,c,!1,null,"018c85cb",null),m=h.exports,f=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"chat-item-text clear-both",class:t.position},[a("comm-avatar",{class:t.position,attrs:{src:t.avatar,wechat:t.wechat}}),a("div",{staticClass:"chat-item-text--container"},[t._v(" "+t._s(t.data.message)+" "),a("span",{staticClass:"chat-item-text--time"},[t._v(t._s(t.data.created_at.substring(11,16)))])])],1)},p=[],g=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.position||t.wechat?a("van-image",{staticClass:"chat-common-avatar",attrs:{src:t.src,heigth:"38",radius:"38"}}):a("div",{staticClass:"chat-common-avatar"},[a("span",[t._v(t._s(t._f("cut_name")(t.user.nickname)))])])},v=[],b={props:{src:"",position:{default:!1,type:Boolean},wechat:{default:!1,type:Boolean}},computed:{user:function(){return this.$store.state.user.info}}},w=b,_=(a("8837"),Object(d["a"])(w,g,v,!1,null,"4edca20c",null)),$=_.exports,x={components:{commAvatar:$},props:{data:{},opposite:!1,avatar:"",wechat:!1},computed:{position:function(){if(!0===this.opposite)return"right"}}},y=x,C=(a("48f3"),Object(d["a"])(y,f,p,!1,null,"2f14a4dd",null)),k=C.exports,B=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"chat-item-image clear-both",class:t.position},[a("comm-avatar",{class:t.position,attrs:{src:t.avatar,wechat:t.wechat}}),a("div",{staticClass:"chat-item-image--container"},[a("van-image",{attrs:{height:t.height,src:t.data.message,width:t.width,radius:"2"},on:{click:function(e){return t.Preview(t.data.message)},load:t.imageLoad}},[a("van-loading",{attrs:{slot:"loading",size:"20",type:"spinner"},slot:"loading"})],1),a("span",{staticClass:"chat-item-image--time"},[t._v(t._s(t.data.created_at.substring(11,16)))])],1)],1)},I=[],O=(a("68ef"),a("a71a"),a("9d70"),a("3743"),a("09fe"),a("4d75"),a("e3b3"),a("8270"),a("786d"),a("504b"),a("28a2")),E={components:{commAvatar:$},props:{data:{},opposite:!1,avatar:"",wechat:!1},data:function(){return{width:240,height:160}},computed:{position:function(){if(!0===this.opposite)return"right"}},methods:{imageLoad:function(){this.width=null,this.height=null,this.$store.dispatch("chatScrollBottom")},Preview:function(t){Object(O["a"])([t])}}},T=E,j=(a("63e6"),Object(d["a"])(T,B,I,!1,null,"122260b2",null)),A=j.exports,H={components:{chatItemTime:m,chatItemText:k,chatItemImage:A},data:function(){return{animate:!1,scroll:!0}},computed:{current:function(){var t=JSON.parse(JSON.stringify(this.$store.state.push.items)),e={};return t.forEach((function(t){var a=t.created_at.substring(5,7)+"月"+t.created_at.substring(8,10)+"日";e.hasOwnProperty(a)||(e[a]=[]),e[a].push(t)})),t.record=e,t}},watch:{"current.record":function(){0!=this.scroll&&this.scrollBottom()}},created:function(){this.scrollBottom()},methods:{getAvatar:function(t){return 1e5===t?"https://ooo28-public.oss-accelerate.aliyuncs.com/yl28/service_logo.png":this.$store.state.user.info.avatar},scrollBottom:function(){this.animate=!0,this.$nextTick((function(){var t=document.getElementById("chat-window");console.log(t.scrollHeight),t.scrollTo({top:t.scrollHeight,behavior:"smooth"})}))},touch:function(t){var e=document.getElementById("chat-window"),a=e.scrollHeight-e.scrollTop;a>1e3?(console.log("不滑了"),this.scroll=!1):a<1e3&&(console.log("又滑了"),this.scroll=!0)}}},J=H,N=(a("bcfd"),Object(d["a"])(J,i,o,!1,null,"b21af8ba",null)),P=N.exports,S=a("6ca8"),L=a.n(S),M={components:{items:P},data:function(){return{message:"",loading:!1,loading_send:!1,loading_image:!1,finished:!1,error:!1,errorText:"请求失败，点击重新加载",page:{current:1},items:[]}},activated:function(){this.$store.commit("read")},methods:{sendMessage:function(){var t=this;if(this.message=this.message.replace(/(^\s*)|(\s*$)/g,""),!this.message)return!1;this.loading_send=!0;var e={message:this.message};this.message="",this.$refs.chat.scroll=!0,this.$post("service/send",e,!1,!1).then((function(e){if(t.loading_send=!1,200!==e.code)return t.$notify(e.message)}))},sendImage:function(t){var e=this;this.$refs.chat.scroll=!0,L()(t.content,{width:1e3,height:1e3,quality:.9}).then((function(t){var a={file:t.base64,type:"base64"};e.loading_image=!0,e.$post("/service/image",a,!1,!1).then((function(t){if(e.loading_image=!1,200!==t.code)return e.$notify(t.message)}))})).catch((function(t){return e.$notify("图片转换失败 请重试")}))},getIndex:function(){var t=this,e={};e.page=this.page.current+1,this.loading=!0,this.$get("service/index",e).then((function(e){t.loading=!1;var a=e.data.items.reverse();t.$store.state.push.items=a.concat(t.$store.state.push.items),e.data.page.current>=e.data.page.last&&(t.finished=!0),1==e.data.page.current&&t.$store.dispatch("chatScrollBottom"),t.page=e.data.page}))}}},z=M,D=(a("2aa8"),Object(d["a"])(z,s,n,!1,null,"79014f4c",null));e["default"]=D.exports}}]);